// =============================================================================
// domain/src/lib.rs: ドメイン層のルートモジュール
// =============================================================================
// クリーンアーキテクチャの最内層（コア）。
// ビジネスルールとエンティティを定義し、外部フレームワークに依存しない。
//
// ドメイン層の責務:
// 1. エンティティの定義（Todo, User, File）
// 2. リポジトリトレイトの定義（永続化の抽象化）
// 3. ドメインエラーの定義
// 4. ビジネスルールのバリデーション
//
// 依存関係の方向:
// ```text
// presentation → application → domain ← infrastructure
//                                 ↑
//                        他の層はここに依存する
// ```
//
// なぜドメイン層は他の層に依存しないのか:
// - ビジネスルールは技術的詳細（DB、HTTP）から独立すべき
// - テストしやすい（モック不要でビジネスロジックをテスト可能）
// - 技術の変更（DB を PostgreSQL から MySQL へ等）が容易
//
// Rust のクレート構造:
// - lib.rs はクレートのルート（エントリーポイント）
// - ここで宣言したモジュールが外部からアクセス可能になる
// - `pub mod` で公開、`mod` で非公開
// =============================================================================

// =============================================================================
// モジュール宣言
// =============================================================================
// `pub mod` で各サブモジュールを公開する。
// これにより外部クレートから `domain::entities::Todo` のようにアクセス可能。
// =============================================================================

/// エンティティモジュール
///
/// ビジネスドメインの中核となるデータ構造を定義。
/// - Todo: TODO アイテム
/// - User: ユーザー（認証用）
/// - File: ファイルメタデータ（TODO 添付ファイル）
pub mod entities;

/// エラーモジュール
///
/// ドメイン層で発生するエラーを定義。
/// - DomainError: バリデーション、認証、NotFound などのエラー型
pub mod errors;

/// リポジトリモジュール
///
/// 永続化の抽象インターフェース（トレイト）を定義。
/// 依存性逆転の原則により、ドメイン層がトレイトを定義し、
/// infrastructure 層が実装を提供する。
///
/// CQRS パターン:
/// - Reader トレイト: 読み取り操作（Queries）
/// - Writer トレイト: 書き込み操作（Commands）
pub mod repositories;

// =============================================================================
// 再エクスポート（Re-export）
// =============================================================================
// `pub use` で主要な型をクレートルートから直接アクセス可能にする。
//
// 再エクスポート前:
//   use domain::entities::Todo;
//   use domain::repositories::TodoReader;
//
// 再エクスポート後:
//   use domain::Todo;
//   use domain::TodoReader;
//
// これにより、使用側のコードが簡潔になる。
// =============================================================================

// -----------------------------------------------------------------------------
// エンティティの再エクスポート
// -----------------------------------------------------------------------------

/// エンティティを直接アクセス可能に
/// `domain::Todo`, `domain::User`, `domain::File` として使用可能
pub use entities::{File, Todo, User};

// -----------------------------------------------------------------------------
// エラーの再エクスポート
// -----------------------------------------------------------------------------

/// ドメインエラーを直接アクセス可能に
/// `domain::DomainError` として使用可能
pub use errors::DomainError;

// -----------------------------------------------------------------------------
// リポジトリトレイトの再エクスポート
// -----------------------------------------------------------------------------

/// リポジトリトレイトを直接アクセス可能に
///
/// CQRS パターンのトレイト:
/// - `FileReader`, `FileWriter`: ファイルの読み書き
/// - `TodoReader`, `TodoWriter`: TODO の読み書き
/// - `UserReader`, `UserWriter`: ユーザーの読み書き
/// - `TodoCacheOps`: TODO キャッシュ操作
/// - `TodoFilter`: TODO 一覧取得のフィルタ条件
/// - `StorageOps`: ファイルストレージ操作（S3 等の抽象化）
pub use repositories::{
    FileReader, FileWriter, StorageOps, TodoCacheOps, TodoFilter, TodoReader, TodoWriter,
    UserReader, UserWriter,
};
